<ui:composition template="template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:b="http://bootsfaces.net/ui">
	
	<ui:define name="content">
<script>

	//<![CDATA[
	$(document).ready(function() {
		renderDataTable();
	});
	
	function renderDataTable(){
		$('#example').DataTable( {
	        "paging":   false,
	        "info":     false,
	        "dom": '<"top"i>rt<"bottom"flp><"clear">',
	        "language": {
	            "search":     "#{msg.programm_lbl_suchen}:",
	            "zeroRecords":"<p class='bg-danger'><i class='fa fa-warning'></i> #{msg.programm_msg_noresult}</p>"
	          }
	    });		
	};
	//]]>
</script>
	<div class="panel panel-default">
	   	<div class="panel-heading">
			<h:outputText class="font-h2" value="#{msg.programm_lbl_title}"/>
	   	</div>
	   	<div class="panel-body">
	   		<p class="font-h3">#{msg.mvidet_lbl_info}</p>

	   		<!-- Filter, Search -->
			<div class="vertical-box">
				<div class="box-tr">	
					<div class="box-td">					
						<h:form>	

							<h:outputText value="#{msg.programm_lbl_genre}"/>
							<h:selectOneMenu class="leftspace-10" value="#{movieEventController.searchGenre}">
								<f:selectItems value="#{movieEventController.getGenres()}"/>
								<f:ajax execute="@this" listener="#{movieEventController.search}" render=":movieForm" onevent="function(data) { if (data.status === 'success') { renderDataTable() } }"/>
							</h:selectOneMenu>
	
							<h:outputText class="leftspace-30" value="#{msg.programm_lbl_language}"/>
							<h:selectOneMenu class="leftspace-10" value="#{movieEventController.searchLanguage}">
								<f:selectItems value="#{movieEventController.getLanguage()}"/>
								<f:ajax execute="@this" listener="#{movieEventController.search}" render=":movieForm" onevent="function(data) { if (data.status === 'success') { renderDataTable() } }"/>
    
							</h:selectOneMenu>
						</h:form>
					</div>		

<!-- 			        <div class="box-td text-right">
		                <div class="input-group form-group-sm stylish-input-group input-append">
		                    <input type="text" class="search form-control" placeholder="Search" />
		                    <span class="input-group-addon input-sm">
		                        <button type="submit">
		                            <span class="glyphicon glyphicon-search"></span>
		                        </button>  
		                    </span>
		                </div>
			        </div>	 -->
								    
	    				    
				</div>
			</div>
				   		
			<h:form id="movieForm">
				hello
				<table id="example" class="table table-striped table-bordered table-responsive">
						<thead>
					      <tr>
					        <th class="col-md-2 col-xs-2">#{msg.programm_lbl_film}</th>
					        <th class="text-center">#{msg.programm_lbl_language}</th>
						    <th class="text-center">#{msg.programm_lbl_saal}</th>
					        <c:forEach items="#{movieEventController.dates}" var="eventDate">
					        	<th class="text-center"><h:outputText value="#{eventDate}" converter="localDateTimeConverter"/></th>
					        </c:forEach>
					      </tr>
					    </thead>
					    <tbody>
							<c:forEach items="#{movieEventController.filteredEvents}" var="event">
							  <tr>
							  	<td>
							  		<h:commandLink action="#{movieEventController.showMovieDetail(event)}">
							  			<h:outputText value="#{event.movie.title}"/><br></br>
							  		</h:commandLink>
							  		<h:outputText value="#{event.movie.getGenreText().toString()}" style="font-size:12px;"/>
							  	</td>
							  	<td class="text-center">
								  	<c:forEach items="#{event.details}" var="detail">
								  		<h:outputText value="#{detail.language.getText()}"/><br></br>
								  	</c:forEach>
							  	</td>
							  	<td class="text-center">
								  	<c:forEach items="#{event.details}" var="detail">
								  		<h:outputText value="#{detail.hall}"/><br></br>
								  	</c:forEach>
							  	</td>
							  	<c:forEach items="#{movieEventController.dates}" var="eventDate">
							  		<td class="text-center">
									  	<c:forEach items="#{event.details}" var="detail">
									  		<c:forEach items="#{detail.eventDateTimes}" var="eventDateTime">
									  			<c:if test="${eventDateTime.showDate eq eventDate}">
									  				<h:commandLink action="#{movieEventController.selectEvent(event, detail, eventDateTime)}">
									  					<h:outputText value="#{eventDateTime.showTime}"/>
									  				</h:commandLink>
									  				<br></br>
									  			</c:if>
									  		</c:forEach>
									  	</c:forEach>
							  		</td>
							  	</c:forEach>
							  </tr>
							</c:forEach>
					    </tbody>
			    </table>
			</h:form>	
		</div>
	</div>
	</ui:define>
</ui:composition>