<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:k="http://java.sun.com/jsf/composite/kinocomp">

<ui:composition template="template.xhtml">
	<ui:define name="content">

	<script type="text/javascript">
        //<![CDATA[
		$(document).ready(function() {
		  $(".search").keyup(function () {
		    var searchTerm = $(".search").val();
		    var listItem = $('.results tbody').children('tr');
		    var searchSplit = searchTerm.replace(/ /g, "'):containsi('")
		    
		  $.extend($.expr[':'], {'containsi': function(elem, i, match, array){
		        return (elem.textContent || elem.innerText || '').toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
		    }
		  });
		    
		  $(".results tbody tr").not(":containsi('" + searchSplit + "')").each(function(e){
		    $(this).attr('visible','false');
		  });
		
		  $(".results tbody tr:containsi('" + searchSplit + "')").each(function(e){
		    $(this).attr('visible','true');
		  });
		
		  var jobCount = $('.results tbody tr[visible="true"]').length;
		    $('.counter').text(jobCount + ' item');
		
		  if(jobCount == '0') {$('.no-result').show();}
		    else {$('.no-result').hide();}
				  });
		});
        //]]>
    </script>
<style>
.results tr[visible='false'],
.no-result{
  display:none;
}
.results tr[visible='true']{
  display:table-row;
}
.counter{
  padding:8px; 
  color:#ccc;
}
</style> 

	<div class="panel panel-default">
	   	<div class="panel-heading">
			<h:outputText class="font-h2" value="#{msg.programm_lbl_title}"/>
	   	</div>
	   	<div class="panel-body">
	   		<p>#{msg.mvidet_lbl_info}</p>
	   		<!-- Filter, Search -->
			<div class="row">		
				<div class="col-sm-9 pull-left">
					<h:form>	
						<h:outputText value="#{msg.programm_lbl_genre}"/>
						<h:selectOneMenu value="#{movieEventController.searchGenre}">
							<f:selectItems value="#{movieEventController.getGenres()}"/>
							<f:ajax execute="@this" listener="#{movieEventController.search}" render=":movieForm" />
						</h:selectOneMenu>
						
						<h:outputText value="#{msg.programm_lbl_language}"/>
						<h:selectOneMenu value="#{movieEventController.searchLanguage}">
							<f:selectItems value="#{movieEventController.getLanguage()}"/>
							<f:ajax execute="@this" listener="#{movieEventController.search}" render=":movieForm" />
						</h:selectOneMenu>
					</h:form>
				</div>					
		        <div class="col-sm-3 pull-right">
	                <div class="input-group stylish-input-group input-append">
	                    <input type="text" class="search form-control" placeholder="Search" />
	                    <span class="input-group-addon">
	                        <button type="submit">
	                            <span class="glyphicon glyphicon-search"></span>
	                        </button>  
	                    </span>
	                </div>
		        </div>
			</div>	  
			<span class="counter pull-right"></span>
			
			<!-- Table Programm --> 		
			<h:form id="movieForm">
				<table id="movieTable" class="table table-hover table-striped results">
					<thead>
				      <tr>
				        <th class="col-md-2 col-xs-2">#{msg.programm_lbl_film}</th>
				        <th>#{msg.programm_lbl_language}</th>
					    <th>#{msg.programm_lbl_saal}</th>
				        <c:forEach items="#{movieEventController.dates}" var="eventDate">
				        	<th><h:outputText value="#{eventDate}" converter="localDateTimeConverter"/></th>
				        </c:forEach>
				      </tr>
				      <tr class="warning no-result">
				      	<td colspan="10"><i class="fa fa-warning"></i> No result</td>
				      </tr>
				    </thead>
				    <tbody>
						<c:forEach items="#{movieEventController.filteredEvents}" var="event">
						  <tr>
						  	<td>
						  		<h:commandLink action="#{movieEventController.showMovieDetail(event)}">
						  			<h:outputText value="#{event.movie.title}"/><br></br>
						  		</h:commandLink>
						  		<h:outputText value="#{event.movie.getGenreText().toString()}" style="font-size:12px;"/>
						  	</td>
						  	<td>
							  	<c:forEach items="#{event.details}" var="detail">
							  		<h:outputText value="#{detail.language.getText()}"/><br></br>
							  	</c:forEach>
						  	</td>
						  	<td>
							  	<c:forEach items="#{event.details}" var="detail">
							  		<h:outputText value="#{detail.hall}"/><br></br>
							  	</c:forEach>
						  	</td>
						  	<c:forEach items="#{movieEventController.dates}" var="eventDate">
						  		<td>
								  	<c:forEach items="#{event.details}" var="detail">
								  		<c:forEach items="#{detail.eventDateTimes}" var="eventDateTime">
								  			<c:if test="${eventDateTime.showDate eq eventDate}">
								  				<h:commandLink action="#{movieEventController.selectEvent(event, detail, eventDateTime)}">
								  					<h:outputText value="#{eventDateTime.showTime}"/>
								  				</h:commandLink>
								  				<br></br>
								  			</c:if>
								  		</c:forEach>
								  	</c:forEach>
						  		</td>
						  	</c:forEach>
						  </tr>
						</c:forEach>
				    </tbody>
				</table>				  
			</h:form>			
			
	   	</div>
	</div>
	    	
	<k:sessionOver></k:sessionOver>

	<h:form>
		<h:commandLink value="sessionOver" onclick="sessionOverDialog.show()" />
	</h:form>

	</ui:define>


</ui:composition>
</html>